<!DOCTYPE html>
<html lang="{{ page.lang | default: site.lang | default: "en" }}">

    <head>
        <script src='https://api.tiles.mapbox.com/mapbox-gl-js/v0.49.0/mapbox-gl.js'></script>
        <link href='https://api.tiles.mapbox.com/mapbox-gl-js/v0.49.0/mapbox-gl.css' rel='stylesheet' />
        <!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-125718262-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-125718262-1');
</script>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

        <title>{% if page.title %}{{ page.title | escape }}{% else %}{{ site.title | escape }}{% endif %}</title>
        <meta name="description" content="{% if page.excerpt %}{{ page.excerpt | strip_html | strip_newlines | truncate: 160 }}{% else %}{{ site.description }}{% endif %}">
        <link rel="stylesheet" href="{{site.baseurl}}/assets/css/main.css">
        <link rel="canonical" href="{{ page.url | replace:'index.html','' | prepend: site.github.url | prepend: site.url }}">
        <link rel="alternate" type="application/rss+xml" title="{{ site.title }}" href="{{ "/feed.xml" | prepend: site.github.url | prepend: site.url }}">
        <style>
        #map { width: 100%; height: 800px; }
        .marker {
            background-image: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAApCAYAAAAiT5m3AAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA3ZpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuNi1jMTExIDc5LjE1ODMyNSwgMjAxNS8wOS8xMC0wMToxMDoyMCAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wTU09Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8iIHhtbG5zOnN0UmVmPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VSZWYjIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtcE1NOk9yaWdpbmFsRG9jdW1lbnRJRD0ieG1wLmRpZDozNWI2ZmIyOS1jZTgwLTZlNGItYjgxYS02NjIyODdkNDljNDUiIHhtcE1NOkRvY3VtZW50SUQ9InhtcC5kaWQ6ODEwODFBODM5MzU5MTFFNzgxNTJDMDdEODY5RUY3RDgiIHhtcE1NOkluc3RhbmNlSUQ9InhtcC5paWQ6ODEwODFBODI5MzU5MTFFNzgxNTJDMDdEODY5RUY3RDgiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENDIDIwMTUgKFdpbmRvd3MpIj4gPHhtcE1NOkRlcml2ZWRGcm9tIHN0UmVmOmluc3RhbmNlSUQ9InhtcC5paWQ6MzViNmZiMjktY2U4MC02ZTRiLWI4MWEtNjYyMjg3ZDQ5YzQ1IiBzdFJlZjpkb2N1bWVudElEPSJ4bXAuZGlkOjM1YjZmYjI5LWNlODAtNmU0Yi1iODFhLTY2MjI4N2Q0OWM0NSIvPiA8L3JkZjpEZXNjcmlwdGlvbj4gPC9yZGY6UkRGPiA8L3g6eG1wbWV0YT4gPD94cGFja2V0IGVuZD0iciI/PiNEC3AAAAU7SURBVHja7FhNTGNVFL79g7YWKKEBIhECA0QWgAkL2OACWZAagQQ1QdgMSAQCy1EzMRM1M4k74yTgAIMsLLULCIKBAAsZSUxEQ4wifwMJCGRAKIGWn0J//Q6+Zx6v75VXRp2NN7lp89699zvnO+d8996nCoVC7Fk0NXtG7X/g/6xp+T8qlUrJeBqk4ebxRgfRA1wPKlmEElorfNDU1CQ5sKenh0C0JSUllvz8/NdiY2NfVqvV6TBWEwwGn3i93h83Nze/Hhsb+x3jfFgnKLNOuMcyA8lDXWVl5Y3U1NTXDQZDNQBz9Hq9SaPRqIilQCDAzs/PK3Jycm62traOO51OO+b9inleGCBbqyq+jmkRocecl/rGxsa6uLi492NiYrLgKaMO0EuLELjP52NnZ2dkxJPT09P73d3dHXh1KvSe95gw1RGoNcCDewkJCZ+ZzeasxMREZjQaw0Cp0TOwwDCOYdzzmHO3vb29H69M3FpXZzVHrx6gd00mU1tSUpKBvFTawAyBa8FSZVtb25d4ZJQCl7JG9zYa4tkKy7WIadSlQmGD0cTQq83NzR+QPZxD0jEmQ6xWazYSZQy03SD6ZD0DCy8VFrL5+Xl2cnIiOcbv97P9/f3Dvb29N/r7+6e4kpOMsS49Pb0e1EYETUQs36qtZWVlZay+vp6lpKRIi4RWy8CcGdTfTE5O1stRrUKdJgH0TQyWBc3NzWV1AEN5/WUEkq4WRhTCeykRooSEAdbS0tIXhXhCYHV2dnYRYppJCSIVN4gHq66uvoifsBE7FRUVrKioiIlzgrzGemaLxWLlVC9MQDTx8fGvYFCMeDJlNS2cl5cXMaHKy8tZZmYmg4JdirtOpyPwEg7PF+Yx2gtSdVpQUMDAhqKMzsjIYMXFxZdLB46gW4R42stGqwxScZqdnWXLy8usqqqKpaWlyYK6XS72lcPBXPgVs0HESe5OlOXoZ1JHIWwEDBsByeHfz9bW1pjb7WbPId5ZoJe88kI2STppvHg+1j3mMMKBMWBbPEkYJ6FRExMT7OjoiMqFNTQ0XGQvabZUYlI9490CX8fiGAeOj4+/g2d+uQOgcFFusYtfvubpVxwqcgRM+Q4ODoZompTHgY2NjRkoFu2v6WJ9JppXVlYuMpw8Jep5A0i9SERWV1cZdqaweQCfX1xcnBUeFC5JJkTBWFNTcx8C3wid/keOOPCUku3jrq6ue7RHS0rmzs7O+eHhoQP7qps8edpGrKDvbG9vDwppltqdguPj4z8A9JHH43lqYKwRQpZ/MzIy8lh8HFKLzlwh7CYeHF8+Raz2qTSu2+g0AuC1qampD3mKr9qPgw6HYwagQwAPXOeKQ3MgmT4AP1hYWHBKHf7CgLkD2nlHR8ctWL0mFA2ljTIbsZ3BuesBr82KDvSchSeg/F2ok1dOVOQ2f+iBa2lpqYU77IWivUn4bTbbODx+SHWrtJGMYvxHk5OTKwANRH2F4Snv7Oy8jVj9piTLaSuEoY96e3sfSiWU4rsTT/nW1lYLPHFFqm2O4kPcKN6LRHE0l7bA4ODgT1CfWxAXn1SW0zO884PiO0NDQ79EolgxMGe5t6+vz44st8HzsBKDpyFQPAaKv7iK4qiuqRy4Z3p6muL9szDeVG4on03sz7dJN66iOOr7McV7bm7Oub6+/g4o/YN0mLZFUOzZ3d1tGR0dfayE4mtdzLGwf3h4eA7JVkfxRg8gk+/Y7fZvxZvAv/FFwD8wMPA9PP4E3YaryefEuFKK5a4w0RjMH0cVfwmQ/SIQRQtGCyZufwowAFs110qMB/8WAAAAAElFTkSuQmCC);
            background-size: cover;
            width: 30px;
            height: 40px;
            border-radius: 50%;
            cursor: pointer;
            opacity: 1.0;
        }
        .marker.filtered {
            opacity: 0.3;
        }
        .mapboxgl-popup {
            max-width: 200px;
        }
        #filters {
            background-color: white;
            height: 24px;
        }
        #filters span {
            display: block;
            float: left;
            margin-right: 10px;
        }
        </style>
    </head>
    <body>
        <nav class="navbar is-spaced" role="navigation" aria-label="main navigation">
            <div class="container">
                <div class="navbar-brand">
                    <a class="navbar-item" href="{{site.baseurl}}">
                        <img src="{{site.baseurl}}/assets/images/brigade_sm.png" alt="Code for America Hurricane Florence Response"
                            width="78" height="28">
                    </a>
                    <a class="navbar-item" href="{{site.url}}">
                            Home
                        </a>
                </div>
                <div class="navbar-menu is-active">
                    <div class="navbar-start">
                    </div>
                    <div class="navbar-end">
                    </div>
                </div>
        </nav>
        <main class="map" role="main">
            <div class="container">
                <div id="map"></div>
                <div id="filters">
                    <span><input type="radio" name="filter" value="all" checked="checked">&nbsp;All</span>
                    <span><input type="radio" name="filter" value="24">&nbsp;Updated &lt; 24 hrs ago</span>
                    <span><input type="radio" name="filter" value="people">&nbsp;Accepting people</span>
                    <span><input type="radio" name="filter" value="pets">&nbsp;Pets allowed</span>
                    <span><input type="radio" name="filter" value="volunteers">&nbsp;Needs volunteers</span>
                    <span><input type="radio" name="filter" value="supplies">&nbsp;Needs supplies</span>
                    <span><input type="radio" name="filter" value="special">&nbsp;Special needs</span>
                </div>
            </div>
        </main>
        <section class="hero is-primary is-small">
            <div class="hero-body">
                <div class="container has-text-centered">
                    <h3 class="title is-3">
                        See Something Missing?
                    </h3>
                    <p>To add more resources to these lists, please submit them here.</p>
                    <p><a class="button is-light" href="https://github.com/hurricane-response/florence_website">GitHub repo</a></p>
                </div>
            </div>
        </section>
        <footer class="footer " role="contentinfo">
			<div class="container has-text-centered">
				<h3 class="title is-3">What is this?</h3>
				<p>This site is built by <a class="has-text-link" href="https://codeforamerica.org">Code for America</a> brigades from across the
					country.
					To participate in data collection, curation, or any other help, please join us - <a class="has-text-link" href="https://bit.ly/2N6YVYD">C4A
						Florence Volunteers</a>.
				</p>
				<img alt="CEDR Dital Corp logo" src="{{site.baseurl}}/assets/images/CEDR_logo.jpg" width="163" />
				<p>Thank you to the <a class="has-text-link" href="https://cedrdigitalcorps.org/"  target="_blank">CEDR Digital Corps</a> for
					collaborating on data collection.</p>
			</div>
		</footer>
	<script>
        window.shelters = null;

        function setFilter() {
            if (!window.shelters) return;
            var filterValue;
            var filters = document.getElementsByName('filter');
            for (var i = 0; i < filters.length; i++) {
                if (filters[i].checked)
                    filterValue = filters[i].value;
            }
            var active = false;
            window.shelters.forEach(function(s) {
                if (filterValue === 'all')
                    active = true;
                else if(filterValue === '24')
                    active = ((+new Date()) - (+new Date(s.last_updated))) < (24 * 60 * 60 * 1000);
                else if(filterValue === 'people')
                    active = s.accepting;
                else if(filterValue === 'pets')
                    active = s.pets;
                else if(filterValue === 'volunteers')
                    active = s.needs.map(function(x) { return x.toLowerCase(); }).indexOf('volunteers') !== -1;
                else if(filterValue === 'supplies')
                    active = s.needs.map(function(x) { return x.toLowerCase(); }).indexOf('supplies') !== -1;
                else if(filterValue === 'special')
                    active = s.special_needs;
                s.marker.getElement().className = active ? 'mapboxgl-marker marker' : 'mapboxgl-marker marker filtered';
            });
        }

        mapboxgl.accessToken = 'pk.eyJ1Ijoic2JtYTQ0IiwiYSI6ImNqbTB1bGFhNjBmMmwzcW9iZjlnaXFvdzIifQ.yTacIggcE99yYxVKIX7vIQ';
        var map = new mapboxgl.Map({
            container: 'map',
            style: 'mapbox://styles/sbma44/cjm0qon9e7u8l2sqliotzrlmi',
            center: [-78, 35.5],
            zoom: 6.1
        });

        var oReq = new XMLHttpRequest();
        oReq.onload = function (e) {
            if (!(e && e.target && e.target.response && e.target.response.shelters))
                return console.log('error fetching shelter JSON');

            window.shelters = e.target.response.shelters;
            for(var i = 0; i < shelters.length; i++) {
                var el = document.createElement('div');
                el.className = 'marker';
                var popup = new mapboxgl.Popup({ offset: 25 })
                    .setHTML('<strong>' + shelters[i].shelter + '</strong><br/>' + shelters[i].address + '<br/><a href="tel:' + shelters[i].cleanPhone + '">' + shelters[i].phone + '</a>');
                shelters[i].marker = new mapboxgl.Marker(el)
                    .setLngLat([shelters[i].longitude, shelters[i].latitude])
                    .setPopup(popup)
                    .addTo(map);
            }
        };
        oReq.open('GET', 'https://hurricane-florence-api.herokuapp.com/api/v1/shelters', true);
        oReq.responseType = 'json';
        oReq.send();

        var filterRadios = document.getElementsByName('filter');
        for(var i = 0; i< filterRadios.length; i++)
            filterRadios[i].onclick = setFilter;
    </script>

    </body>
</html>